CREATE TABLE IF NOT EXISTS app (
    Key text PRIMARY KEY,
    Value TIMESTAMPTZ
);

INSERT INTO app (Key, Value) VALUES ('last commit', CURRENT_TIMESTAMP) ON CONFLICT DO NOTHING;

CREATE TABLE IF NOT EXISTS errors (
    REF text PRIMARY KEY,
    ERROR_TIME TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    CAUSE TEXT NOT NULL,
    TRACEBACK TEXT NOT NULL
);

-- users

CREATE TABLE IF NOT EXISTS users (
	U_UUID VARCHAR(17) PRIMARY KEY,
    USR_NAME VARCHAR(60) NOT NUll,
    FULL_NAME VARCHAR(100) NOT NULL, -- not implemented
    EMAIL VARCHAR(255) NOT NULL,
    PASS_KEY VARCHAR(255) NOT NULL UNIQUE,
    IS_VERIFIED BOOLEAN DEFAULT FALSE,
    PHONE VARCHAR(30) NOT NULL,
    AVATAR VARCHAR(30),
    JOINED_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMPTZ, -- not implemented
    LAST_LOGIN TIMESTAMPTZ, -- not implemented
	Active BOOLEAN DEFAULT TRUE,
    IS_SUPER_USR BOOLEAN DEFAULT FALSE
);

-- business

CREATE TABLE IF NOT EXISTS business (
	BS_UUID VARCHAR(17) PRIMARY KEY,
    BS_NAME VARCHAR(120) NOT NULL UNIQUE,
    CATEGORIES VARCHAR(255)[], -- not implemented
    CITY VARCHAR(60) NOT NULL,
    BS_WEBSITE VARCHAR(255),
    BS_EMAIL VARCHAR(255), -- not implemented
    BS_LOGO VARCHAR(30),
--    BS_COVER_IMAGE VARCHAR(30), -- not implemented
--    BS_ADDRESS JSON NOT NULL, -- not implemented
--    BS_LOCATION GEOGRAPHY(POINT), -- not implemented
--    OPENING_HOURS JSON NOT NULL, -- not implemented
    BS_DESCRIPTION TEXT,
    BS_PHONE VARCHAR(30) NOT NULL, -- not implemented
    CREATED_AT TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMPTZ, -- not implemented
    IS_VERIFIED BOOLEAN DEFAULT FALSE, -- not implemented
    SUBSCRIBEDTO VARCHAR(255)[],
--    IS_ACTIVE BOOLEAN DEFAULT FALSE, -- not implemented
    BS_OWNER_ID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_ID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- postgresql

CREATE TABLE IF NOT EXISTS postgresql (
    PGSQL_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(10) DEFAULT 'postgresql',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT INT NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- oracledb

CREATE TABLE IF NOT EXISTS oracledb (
    ORDB_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(8) DEFAULT 'oracledb',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- mysql

CREATE TABLE IF NOT EXISTS mysql (
    MYSQL_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(5) DEFAULT 'mysql',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- mssql

CREATE TABLE IF NOT EXISTS mssql (
    MSSQL_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(5) DEFAULT 'mssql',
    DB_DRIVER VARCHAR(12) NOT NULL,
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- mongodb

CREATE TABLE IF NOT EXISTS mongodb (
    MGDB_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(7) DEFAULT 'mongodb',
    DB_USER VARCHAR(120) NOT NULL,
    DB_CLUSTER_NAME VARCHAR(255) NOT NULL,
--    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- ibmdb2

CREATE TABLE IF NOT EXISTS ibmdb2 (
    IBMDB2_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(6) DEFAULT 'ibmdb2',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- redis

CREATE TABLE IF NOT EXISTS redis (
    REDIS_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(5) DEFAULT 'redis',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- elasticsearch

CREATE TABLE IF NOT EXISTS elasticsearch (
    ELSRCH_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(13) DEFAULT 'elasticsearch',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
--    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);

-- mariadb

CREATE TABLE IF NOT EXISTS mariadb (
    MRADB_UUID VARCHAR(17) PRIMARY KEY,
    DB_TYPE VARCHAR(7) DEFAULT 'mariadb',
    DB_USER VARCHAR(120) NOT NULL,
    DB_HOST VARCHAR(255) NOT NULL,
    DB_PORT VARCHAR(6) NOT NULL,
    DB_NAME VARCHAR(120) NOT NULL,
    DB_PWD VARCHAR(255) NOT NULL UNIQUE,
    BUSINESS_UUID VARCHAR(17),
    CONSTRAINT fk_business_id
        FOREIGN KEY (BUSINESS_UUID)
        REFERENCES business (BS_UUID)
        ON DELETE CASCADE,
    BS_OWNER_UUID VARCHAR(17),
    CONSTRAINT fk_user_id
        FOREIGN KEY (BS_OWNER_UUID)
        REFERENCES users (U_UUID)
        ON DELETE CASCADE
);